# Network Policies practice for Kubernetes cluster setup

üìù Network Policies allow you to prevent or restrict network communication to and from Pods. Network Policies are "an application-centric construct which allow you to specify how a pod is allowed to communicate with various network _entities_ over the network". They "do not conflict; they are additive".

## Scenarios

* Block all traffic to and from Pods in a namespace

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny-all
  namespace: test-ns
spec:
  podSelector: {}   # all Pods in the namespace
  policyTypes:
    - Ingress       # incoming traffic
    - Egress        # outgoing trafiic
```

* Allow all traffic to Pods in a namespace

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-all-ingress
spec:
  podSelector: {}
  ingress:
    - {}
  policyTypes:
    - Ingress
```

* Allow traffic to Pod with a label `pod=ingress` in namespace `test` from pods in the namespace `default` **OR** from pods in the local namespace with the label `demo=pod`

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: example-ingress
  namespace: test
spec:
  podSelector:
    matchLabels:
      pod: ingress
  policyTypes:
    - Ingress
  ingress: 
    - from: 
      - namespaceSelector: 
          matchLabels: 
            ns: default
      - podSelector:
          matchLabels:
            demo: pod
```

* Allow traffic from Pod with a label `pod=egress` in namespace `test` to pods in the namespace `default` **AND** with the label `demo=pod`

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: example-egress
  namespace: test
spec:
  podSelector:
    matchLabels:
      pod: egress
  policyTypes:
    - Egress
  egress: 
    - to: 
      - namespaceSelector: 
          matchLabels: 
            ns: default
        podSelector:
          matchLabels:
            demo: pod
```
