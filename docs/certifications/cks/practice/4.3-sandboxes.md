# Sandboxes

## Example 1

Look at the [Container Runtime Interface (CRI)](https://kubernetes.io/docs/concepts/architecture/cri/) configuration with [containerd](https://containerd.io/), in `/etc/containerd/config.toml`, under the handlers section:

```ini
[plugins.cri.containerd.runtimes.runsc]
runtime_type = "io.containerd.runsc.v1"
```

Create a RuntimeClass:

```yaml
apiVersion: node.k8s.io/v1 
kind: RuntimeClass
metadata:
  name: gvisor  
handler: runsc
```

Create a Deployment manifest file with `kubectl create deploy test --image=nginx --dry-run=client -o yaml > deploy.yaml` and edit it to add runtimeClassName:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: test
  name: test
spec:
  replicas: 1
  selector:
    matchLabels:
      app: test
  template:
    metadata:
      labels:
        app: test
    spec:
      runtimeClassName: gvisor
      containers:
        - image: nginx
      name: nginx
```

On the newly created Pod, test if it uses gViser sandbox (should see "[   0.000000] Starting gVisor..." at the beginning):

```bash
kubectl exec test-xxxx -- dmesg
```

## Example 2

Create a RuntimeClass (`vi some_file.yaml` then `kubectl apply -f some_file.yaml`):

```yaml
apiVersion: node.k8s.io/v1
kind: RuntimeClass
metadata:
  name: sandbox
handler: runsc
```

Edit existing deployments to add `runtimeClassName: sandbox`:

```bash
kubectl edit deploy buffy -n sunnydale
kubectl edit deploy giles -n sunnydale
kubectl edit deploy spike -n sunnydale
```

Check gVisor started correctly:

```bash
kubectl exec buffy-xxxx -n sunnydale -- dmesg
```
